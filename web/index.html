<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DIPROCHIL - Iniciar Sesión</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
  
  <!-- CONTENEDOR DE LOGIN -->
  <div class="login-container">
    <div class="login-card">
      
      <!-- HEADER DEL LOGIN -->
      <div class="login-header">
        <img
          src="assets/images/logo-diprochil.png"
          alt="DIPROCHIL"
          style="width: 96px; height: 96px; object-fit: contain; margin: 0 auto 12px; display: block;"
        >
        <h1 class="login-logo">DIPROCHIL</h1>
        <p class="login-subtitle">Sistema de Gestión de Rutas de Despacho</p>
      </div>

      <!-- MENSAJES DE ERROR/ÉXITO -->
      <div id="message-container"></div>

      <!-- FORMULARIO DE LOGIN -->
      <form id="loginForm">
        
        <!-- EMAIL -->
        <div class="form-group">
          <label for="email" class="form-label required">Correo Electrónico</label>
          <input 
            type="email" 
            id="email" 
            class="form-input" 
            placeholder="tucorreo@ejemplo.com"
            autocomplete="email"
            required
          >
          <span class="form-error"></span>
        </div>

        <!-- PASSWORD -->
        <div class="form-group">
          <label for="password" class="form-label required">Contraseña</label>
          <input 
            type="password" 
            id="password" 
            class="form-input" 
            placeholder="••••••••"
            autocomplete="current-password"
            required
          >
          <span class="form-error"></span>
        </div>

        <!-- RECORDAR SESIÓN (OPCIONAL - NO FUNCIONAL AÚN) -->
        <div class="form-check mb-4">
          <input type="checkbox" id="remember" class="form-check-input">
          <label for="remember" class="form-check-label">Recordar sesión</label>
        </div>

        <!-- BOTÓN DE LOGIN -->
        <button type="submit" class="btn btn-primary btn-block btn-lg" id="loginBtn">
          Iniciar Sesión
        </button>

      </form>

      <!-- FOOTER DEL LOGIN (OPCIONAL) -->
      <div class="text-center mt-6 text-sm text-muted">
        <p>&copy; 2026 DIPROCHIL - Sistema de Gestión de Rutas</p>
      </div>

    </div>
  </div>

  <!-- JAVASCRIPT -->
  <script src="js/config.js"></script>
  <script src="js/api.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/auth.js"></script>
  
  <script>
    /* ========================================
       LÓGICA DEL LOGIN
       ======================================== */

    // Si ya está autenticado, redirigir al dashboard
    if (Auth.isAuthenticated()) {
      Auth.redirectToDashboard();
    }

    // Manejar submit del formulario
    const loginForm = document.getElementById('loginForm');
    const loginBtn = document.getElementById('loginBtn');
    const messageContainer = document.getElementById('message-container');

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Limpiar mensajes previos
      messageContainer.innerHTML = '';
      UI.clearFieldError('email');
      UI.clearFieldError('password');

      // Obtener valores
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      // Validaciones básicas
      if (!email) {
        UI.showFieldError('email', 'El correo es requerido');
        return;
      }

      if (!UI.validateEmail(email)) {
        UI.showFieldError('email', 'El correo no es válido');
        return;
      }

      if (!password) {
        UI.showFieldError('password', 'La contraseña es requerida');
        return;
      }

      if (password.length < 6) {
        UI.showFieldError('password', 'La contraseña debe tener al menos 6 caracteres');
        return;
      }

      // Mostrar loading en botón
      UI.setButtonLoading(loginBtn, true);

      try {
        // Llamar al API de login
        const response = await Auth.login(email, password);

        // Mostrar mensaje de éxito
        messageContainer.innerHTML = `
          <div class="alert alert-success">
            ¡Bienvenido! Redirigiendo...
          </div>
        `;

        // Redirigir según rol después de 1 segundo
        setTimeout(() => {
          Auth.redirectToDashboard();
        }, 1000);

      } catch (error) {
        // Mostrar error
        messageContainer.innerHTML = `
          <div class="alert alert-danger">
            ${error.message || 'Credenciales inválidas. Verifica tu correo y contraseña.'}
          </div>
        `;

        // Quitar loading del botón
        UI.setButtonLoading(loginBtn, false);
      }
    });

    // Limpiar errores al escribir
    document.getElementById('email').addEventListener('input', () => {
      UI.clearFieldError('email');
    });

    document.getElementById('password').addEventListener('input', () => {
      UI.clearFieldError('password');
    });
  </script>

</body>
</html>